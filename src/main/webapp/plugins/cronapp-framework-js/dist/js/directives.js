function maskDirectiveAsDate(e,t){return maskDirective(e,t,"as-date")}function maskDirectiveMask(e,t){return maskDirective(e,t,"mask")}function maskDirective(e,t,n){return{restrict:"A",require:"?ngModel",link:function(e,a,i,r){if("as-date"!=n||void 0===i.mask){var o=$(a),l=o.attr("type");if("checkbox"!=l&&"password"!=l){o.data("type",l),o.attr("type","text"),r&&(r.$formatters=[],r.$parsers=[]),void 0!==i.asDate&&"text"==l&&(l="date");var s=!1,c=i.mask||i.format;c=c?parseMaskType(c,t):parseMaskType(l,t),c.endsWith(";0")&&(s=!0);var d=c.replace(";1","").replace(";0","").trim();if(void 0!=d&&0!=d.length)if("date"==l||"datetime"==l||"datetime-local"==l||"month"==l||"time"==l||"time-local"==l||"week"==l){var u={format:d,locale:t.use(),showTodayButton:!0,useStrict:!0,tooltips:{today:t.instant("DatePicker.today"),clear:t.instant("DatePicker.clear"),close:t.instant("DatePicker.close"),selectMonth:t.instant("DatePicker.selectMonth"),prevMonth:t.instant("DatePicker.prevMonth"),nextMonth:t.instant("DatePicker.nextMonth"),selectYear:t.instant("DatePicker.selectYear"),prevYear:t.instant("DatePicker.prevYear"),nextYear:t.instant("DatePicker.nextYear"),selectDecade:t.instant("DatePicker.selectDecade"),prevDecade:t.instant("DatePicker.prevDecade"),nextDecade:t.instant("DatePicker.nextDecade"),prevCentury:t.instant("DatePicker.prevCentury"),nextCentury:t.instant("DatePicker.nextCentury")}};"DD/MM/YYYY"!=d&&"MM/DD/YYYY"!=d&&(u.sideBySide=!0);var p="date"==l||"datetime"==l||"time"==l;if(o.attr("from-grid")){if(o.on("click",function(){var e=$(this).offset(),t=!0,n=$(this).parent().find(".bootstrap-datetimepicker-widget.dropdown-menu.usetwentyfour.bottom");n.length||(t=!1,n=$(this).parent().find(".bootstrap-datetimepicker-widget.dropdown-menu.usetwentyfour.top"));var a=$(n).offset().left,i=n.closest("cron-grid");n.appendTo(i);var r=0;r=t?e.top+35:e.top-($(n).height()+15),n.css("top",r),n.css("bottom","auto"),n.css("left",a)}),o.on("dp.change",function(){var e=null;e=p?moment.utc(o.val(),d):moment(o.val(),d),o.data("rawvalue",e.toDate())}),o.data("initial-value")){var m=o.data("initial-value"),f=null;f=p?moment.utc(m):moment(m),o.val(f.format(d)),o.data("initial-value",null)}}else o.wrap('<div style="position:relative"></div>');o.datetimepicker(u),o.on("dp.change",function(){$(this).is(":visible")&&($(this).trigger("change"),e.$apply(function(){var e=o.val(),t=null;t=p?moment.utc(e,d):moment(e,d),t.isValid()&&r&&r.$setViewValue(t.toDate())}))}),r&&(r.$formatters.push(function(e){if(e){var t=null;return t=p?moment.utc(e):moment(e),t.format(d)}return null}),r.$parsers.push(function(e){if(e){var t=null;return t=p?moment.utc(e,d):moment(e,d),t.toDate()}return null}))}else if("number"==l||"money"==l||"integer"==l){s=!0,!1;var g=d.trim().replace(/\./g,"").replace(/\,/g,"").replace(/#/g,"").replace(/0/g,"").replace(/9/g,""),v="",h="",y="",k=",",b=0;d.startsWith(g)?v=g:d.endsWith(g)&&(h=g);var w=d.trim().replace(v,"").replace(h,"").trim();w.startsWith("#.")?y=".":w.startsWith("#,")&&(y=",");var M=null;if(-1!=w.indexOf(",0")?(k=",",M=",0"):-1!=w.indexOf(".0")&&(k=".",M=".0"),null!=M){var S=w.substring(w.indexOf(M)+1);b=S.length}var D="numeric";0==b&&(D="integer");var C={rightAlign:"money"==l,unmaskAsNumber:!0,allowMinus:!0,prefix:v,suffix:h,radixPoint:k,digits:b};y&&(C.autoGroup=!0,C.groupSeparator=y),$(a).inputmask(D,C);var x=function(){$(this).data("rawvalue",$(this).inputmask("unmaskedvalue"))};$(a).on("keydown",x).on("keyup",x),r&&(r.$formatters.push(function(e){return void 0!=e&&null!=e&&""!=e?format(d,e):null}),r.$parsers.push(function(e){if(void 0!=e&&null!=e&&""!=e){var t=o.inputmask("unmaskedvalue");if(""!=t)return t}return null}))}else if("text"==l||"tel"==l){var u={};i.maskPlaceholder&&(u.placeholder=i.maskPlaceholder),o.mask(d,u);var x=function(){s&&$(this).data("rawvalue",$(this).cleanVal())};$(a).on("keydown",x).on("keyup",x),s&&r&&(r.$formatters.push(function(e){return e?o.masked(e):null}),r.$parsers.push(function(e){return e?o.cleanVal():null}))}else if(o.attr("from-grid")){var x=function(){$(this).data("rawvalue",$(this).val())};$(a).on("keydown",x).on("keyup",x)}}}}}}function parseMaskType(e,t){return"datetime"==e||"datetime-local"==e?"Format.DateTime"==(e=t.instant("Format.DateTime"))&&(e="DD/MM/YYYY HH:mm:ss"):"date"==e?"Format.Date"==(e=t.instant("Format.Date"))&&(e="DD/MM/YYYY"):"time"==e||"time-local"==e?"Format.Hour"==(e=t.instant("Format.Hour"))&&(e="HH:mm:ss"):"month"==e?e="MMMM":"number"==e?"Format.Decimal"==(e=t.instant("Format.Decimal"))&&(e="0,00"):"money"==e?"Format.Money"==(e=t.instant("Format.Money"))&&(e="#.#00,00"):"integer"==e?e="0":"week"==e?e="dddd":"tel"==e?e="(00) 00000-0000;0":"text"==e&&(e=""),e}maskDirectiveAsDate.$inject=["$compile","$translate"],maskDirectiveMask.$inject=["$compile","$translate"],function($app){var isoDate=/(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))/,patternFormat=function(e){return e?$(e).attr("format")||"DD/MM/YYYY":"DD/MM/YYYY"},parsePermission=function(e){var t={visible:{public:!0},enabled:{public:!0}};if(e)for(var n=e.toLowerCase().trim().split(","),a=0;a<n.length;a++){var i=n[a].trim();if(i){var r=i.split(":");if(2==r.length){var o=r[0].trim(),l=r[1].trim();if(l){for(var s=l.split(";"),c={},d=0;d<s.length;d++){var u=s[d].trim();u&&(c[u]=!0)}t[o]=c}}}}return t};app.directive("asDate",maskDirectiveAsDate).directive("ngDestroy",function(){return{restrict:"A",link:function(scope,element,attrs,ctrl){element.on("$destroy",function(){attrs.ngDestroy&&attrs.ngDestroy.length>0&&(attrs.ngDestroy.indexOf("app.")>-1||attrs.ngDestroy.indexOf("blockly.")>-1?scope.$eval(attrs.ngDestroy):eval(attrs.ngDestroy))})}}}).directive("dynamicImage",["$compile",function(e){return{restrict:"E",replace:!0,scope:{ngModel:"@",width:"@",height:"@",style:"@",class:"@"},require:"ngModel",template:"<div></div>",init:function(e){e.ngModel||(e.ngModel=""),e.width||(e.width="128"),e.height||(e.height="128"),e.style||(e.style=""),e.class||(e.class=""),this.containsLetter(e.width)||(e.width+="px"),this.containsLetter(e.height)||(e.height+="px")},containsLetter:function(e){for(var t,n=0;n<e.length;n++){t=!0;for(var a=0;a<10;a++)parseInt(e[n])==a&&(t=!1);if(t)break}return t},link:function(t,n,a){this.init(t);var i=t,r=a.ngRequired&&"true"==a.ngRequired?"required":"";n.append('<div class="form-group upload-image-component" ngf-drop="" ngf-drag-over-class="dragover">                                  <img class="$class$" style="$style$; height: $height$; width: $width$;" ng-if="$ngModel$" data-ng-src="{{$ngModel$.startsWith(\'http\') || ($ngModel$.startsWith(\'/\') && $ngModel$.length < 1000)? $ngModel$ : \'data:image/png;base64,\' + $ngModel$}}">                                  <img class="$class$" style="$style$; height: $height$; width: $width$;" ng-if="!$ngModel$" data-ng-src="/plugins/cronapp-framework-js/img/selectImg.svg" class="btn" ng-if="!$ngModel$" ngf-drop="" ngf-select="" ngf-change="cronapi.internal.setFile(\'$ngModel$\', $file)" accept="image/*;capture=camera">                                  <div class="remove btn btn-danger btn-xs" ng-if="$ngModel$" ng-click="$ngModel$=null">                                    <span class="glyphicon glyphicon-remove"></span>                                  </div>                                  <div class="btn btn-info btn-xs start-camera-button" ng-if="!$ngModel$" ng-click="cronapi.internal.startCamera(\'$ngModel$\')">                                    <span class="glyphicon glyphicon-facetime-video"></span>                                  </div>                                  <input ng-if="!$ngModel$" autocomplete="off" tabindex="-1" class="uiSelectRequired ui-select-offscreen" style="top: inherit !important; margin-left: 85px !important;margin-top: 50px !important;" type=text ng-model="$ngModel$" $required$>                                </div>'.split("$height$").join(i.height).split("$width$").join(i.width).split("$ngModel$").join(i.ngModel).split("$style$").join(i.style).split("$class$").join(i.class).split("$required$").join(r)),e(n)(n.scope())}}}]).directive("dynamicImage",["$compile",function(e){return{restrict:"A",scope:!0,require:"ngModel",link:function(t,n,a){var i=a.ngRequired&&"true"==a.ngRequired?"required":"",r=n.html(),o='<div ngf-drop="" ngf-drag-over-class="dragover">                   <img style="width: 100%;" ng-if="$ngModel$" data-ng-src="{{$ngModel$.startsWith(\'http\') || ($ngModel$.startsWith(\'/\') && $ngModel$.length < 1000)? $ngModel$ : \'data:image/png;base64,\' + $ngModel$}}">                   <input ng-if="!$ngModel$" autocomplete="off" tabindex="-1" class="uiSelectRequired ui-select-offscreen" style="top: inherit !important; margin-left: 85px !important;margin-top: 50px !important;" type=text ng-model="$ngModel$" $required$>                   <div class="btn" ng-if="!$ngModel$" ngf-drop="" ngf-select="" ngf-change="cronapi.internal.setFile(\'$ngModel$\', $file)" ngf-pattern="\'image/*\'" ngf-max-size="$maxFileSize$">                     $userHtml$                   </div>                   <div class="remove-image-button btn btn-danger btn-xs" ng-if="$ngModel$" ng-click="$ngModel$=null">                     <span class="glyphicon glyphicon-remove"></span>                   </div>                   <div class="btn btn-info btn-xs start-camera-button-attribute" ng-if="!$ngModel$" ng-click="cronapi.internal.startCamera(\'$ngModel$\')">                     <span class="glyphicon glyphicon-facetime-video"></span>                   </div>                 </div>',l="";a.maxFileSize&&(l=a.maxFileSize),o=$(o.split("$ngModel$").join(a.ngModel).split("$required$").join(i).split("$userHtml$").join(r).split("$maxFileSize$").join(l)),n.html(o),e(o)(n.scope())}}}]).directive("dynamicFile",["$compile",function(e){return{restrict:"A",scope:!0,require:"ngModel",link:function(t,n,a){var i=a.ngRequired&&"true"==a.ngRequired?"required":"",r=a.ngModel.split("."),o=r[0],l=r[r.length-1],s=Math.floor(1e3*Math.random()+20),c=n.html(),d="";a.maxFileSize&&(d=a.maxFileSize);var u='                                <div ng-show="!$ngModel$" ngf-drop="" ngf-drag-over-class="dragover">                                  <input ng-if="!$ngModel$" autocomplete="off" tabindex="-1" class="uiSelectRequired ui-select-offscreen" style="top: inherit !important;margin-left: 85px !important;margin-top: 50px !important;" type=text ng-model="$ngModel$" $required$>                                  <div class="btn" ngf-drop="" ngf-select="" ngf-change="cronapi.internal.uploadFile(\'$ngModel$\', $file, \'uploadprogress$number$\')" ngf-max-size="$maxFileSize$">                                    $userHtml$                                  </div>                                  <div class="progress" data-type="bootstrapProgress" id="uploadprogress$number$" style="display:none">                                    <div class="progress-bar" role="progressbar" aria-valuenow="70" aria-valuemin="0" aria-valuemax="100" style="width:0%">                                      <span class="sr-only"></span>                                    </div>                                  </div>                                </div>                                 <div ng-show="$ngModel$" class="upload-image-component-attribute">                                   <div class="btn btn-danger btn-xs ng-scope" style="float:right;" ng-if="$ngModel$" ng-click="$ngModel$=null">                                     <span class="glyphicon glyphicon-remove"></span>                                   </div>                                   <div>                                     <div ng-bind-html="cronapi.internal.generatePreviewDescriptionByte($ngModel$)"></div>                                     <a href="javascript:void(0)" ng-click="cronapi.internal.downloadFileEntity($datasource$,\'$field$\')">download</a>                                   </div>                                 </div>                                 ';u=$(u.split("$ngModel$").join(a.ngModel).split("$datasource$").join(o).split("$field$").join(l).split("$number$").join(s).split("$required$").join(i).split("$userHtml$").join(c).split("$maxFileSize$").join(d)),n.html(u),e(u)(n.scope())}}}]).directive("dynamicFile",["$compile",function(e){return{restrict:"E",replace:!0,scope:{ngModel:"@"},require:"ngModel",template:"<div></div>",init:function(e){e.ngModel||(e.ngModel="")},link:function(t,n,a){this.init(t);var i=t,r=a.ngRequired&&"true"==a.ngRequired?"required":"",o=i.ngModel.split("."),l=o[0],s=o[o.length-1],c=Math.floor(1e3*Math.random()+20);n.append('                                <div ng-show="!$ngModel$">                                  <input ng-if="!$ngModel$" autocomplete="off" tabindex="-1" class="uiSelectRequired ui-select-offscreen" style="top: inherit !important;margin-left: 85px !important;margin-top: 50px !important;" type=text ng-model="$ngModel$" $required$>                                  <div class="form-group upload-image-component" ngf-drop="" ngf-drag-over-class="dragover">                                     <img class="ng-scope" style="height: 128px; width: 128px;" ng-if="!$ngModel$" data-ng-src="/plugins/cronapp-framework-js/img/selectFile.png" ngf-drop="" ngf-select="" ngf-change="cronapi.internal.uploadFile(\'$ngModel$\', $file, \'uploadprogress$number$\')" accept="*">                                    <progress id="uploadprogress$number$" max="100" value="0" style="position: absolute; width: 128px; margin-top: -134px;">0</progress>                                  </div>                                </div>                                 <div ng-show="$ngModel$" class="form-group upload-image-component">                                   <div class="btn btn-danger btn-xs ng-scope" style="float:right;" ng-if="$ngModel$" ng-click="$ngModel$=null">                                     <span class="glyphicon glyphicon-remove"></span>                                   </div>                                   <div>                                     <div ng-bind-html="cronapi.internal.generatePreviewDescriptionByte($ngModel$)"></div>                                     <a href="javascript:void(0)" ng-click="cronapi.internal.downloadFileEntity($datasource$,\'$field$\')">download</a>                                   </div>                                 </div>                                 '.split("$ngModel$").join(i.ngModel).split("$datasource$").join(l).split("$field$").join(s).split("$number$").join(c).split("$required$").join(r)),e(n)(n.scope())}}}]).directive("pwCheck",[function(){"use strict";return{require:"ngModel",link:function(e,t,n,a){var i="#"+n.pwCheck;t.add(i).on("keyup",function(){e.$apply(function(){var e=t.val()===$(i).val();a.$setValidity("pwmatch",e)})})}}}]).directive("ngClick",[function(){"use strict";return{link:function(scope,elem,attrs,ctrl){if(scope.rowData){var crnDatasource=elem.closest("[crn-datasource]");crnDatasource.length>0&&elem.on("click",function(){scope.$apply(function(){var datasource=eval(crnDatasource.attr("crn-datasource"));datasource.active=scope.rowData})})}}}}]).directive("valid",function(){return{require:"^ngModel",restrict:"A",link:function(e,t,n,a){var i={cpf:CPF,cnpj:CNPJ};a.$validators[n.valid]=function(e,a){var r=e||a,o=i[n.valid].isValid(r);return o?t[0].setCustomValidity(""):t.scope().$applyAsync(function(){t[0].setCustomValidity(t[0].dataset.errorMessage)}),o||!r}}}}).directive("cronappSecurity",function(){return{restrict:"A",link:function(e,t,n){var a=[];e.session&&e.session.roles&&(a=e.session.roles.toLowerCase().split(","));for(var i=parsePermission(n.cronappSecurity),r=!1,o=!1,l=0;l<a.length;l++){var s=a[l].trim();s&&(i.visible[s]&&(r=!0),i.enabled[s]&&(o=!0))}r||$(t).hide(),o||$(t).find("*").addBack().attr("disabled",!0)}}}).directive("qr",["$window",function(e){return{restrict:"A",require:"^ngModel",template:'<canvas ng-hide="image"></canvas><img ng-if="image" ng-src="{{canvasImage}}"/>',link:function(t,n,a,i){void 0===t.size&&a.size&&(t.text=a.size);var r=function(){return i.$modelValue||""},o=function(e){return/^[0-9]*$/.test(e)},l=function(e){return/^[0-9A-Z $%*+\-.\/:]*$/.test(e)},s=function(e){for(var t=0;t<e.length;t++){if(e.charCodeAt(t)>255)return!1}return!0},c=function(e,t){if("NUMBER"===e&&!o(t))throw new Error("The `NUMBER` input mode is invalid for text.");if("ALPHA_NUM"===e&&!l(t))throw new Error("The `ALPHA_NUM` input mode is invalid for text.");if("8bit"===e&&!s(t))throw new Error("The `8bit` input mode is invalid for text.");if(!s(t))throw new Error("Input mode is invalid for text.");return!0},d=function(e){var n=t.inputMode;return n=n||(o(e)?"NUMBER":void 0),n=n||(l(e)?"ALPHA_NUM":void 0),n=n||(s(e)?"8bit":""),c(n,e)?n:""},u=n.find("canvas")[0],p=!!e.CanvasRenderingContext2D;t.TYPE_NUMBER=function(){return t.typeNumber||0}(),t.TEXT=r(),t.CORRECTION=function(){return{L:1,M:0,Q:3,H:2}[t.correctionLevel||0]||0}(),t.SIZE=function(){return t.size||$(n).outerWidth()}(),t.INPUT_MODE=d(t.TEXT),t.canvasImage="";var m=function(e,t,n,a){for(var i=0;i<n;i++)for(var r=0;r<n;r++){var o=Math.ceil((r+1)*a)-Math.floor(r*a),l=Math.ceil((i+1)*a)-Math.floor(i*a);e.fillStyle=t.isDark(i,r)?"#000":"#fff",e.fillRect(Math.round(r*a),Math.round(i*a),o,l)}},f=function(e,n,a,i,r,o){var l=/^\s+|\s+$/g,s=n.replace(l,""),c=new QRCode(a,i,o);c.addData(s),c.make();var d=e.getContext("2d"),u=c.getModuleCount(),f=r/u;e.width=e.height=r,p&&(m(d,c,u,f),t.canvasImage=e.toDataURL()||"")};t.$watch(function(){return i.$modelValue},function(e,n){e!==n&&(t.text=i.$modelValue,t.TEXT=r(),t.INPUT_MODE=d(t.TEXT),f(u,t.TEXT,t.TYPE_NUMBER,t.CORRECTION,t.SIZE,t.INPUT_MODE))}),f(u,t.TEXT,t.TYPE_NUMBER,t.CORRECTION,t.SIZE,t.INPUT_MODE)}}}]).directive("uiSelect",["$compile",function(e){return{restrict:"E",require:"ngModel",link:function(t,n,a,i){if(void 0!=a.required||"true"===a.ngRequired){$(n).append('<input autocomplete="off" tabindex="-1" class="uiSelectRequired ui-select-offscreen" style="left: 50%!important; top: 100%!important;" type=text ng-model="'+a.ngModel+'" required>');var r=$(n).find("input.uiSelectRequired");e(r)(n.scope())}}}}]).filter("raw",["$translate",function(e){return function(e){return e?"number"==typeof e?e+"":e instanceof Date?"datetime'"+e.toISOString()+"'":"'"+e+"'":""}}]).filter("mask",["$translate",function(e){return function(t,n){if(!(n=parseMaskType(n,e)))return t;if(n=n.replace(";1","").replace(";0","").trim(),"string"==typeof t&&t.match(isoDate))return moment.utc(t).format(n);if(t instanceof Date)return moment.utc(t).format(n);if("number"==typeof t)return format(n,t);if(void 0!=t&&null!=t&&""!=t){var a=$('<input type="text">');return a.mask(n),a.masked(t)}return t}}]).directive("mask",maskDirectiveMask).directive("cronappFilter",["$compile",function($compile){return{restrict:"A",require:"?ngModel",setFilterInButton:function(e,t,n){var a=e.closest("fieldset");if(a){var i=a.find("button[cronapp-filter]");if(i){var r=i.data("filters");r||(r=[]);var o=-1,l=e.attr("ng-model");if($(r).each(function(e){this.ngModel==l&&(o=e)}),o>-1&&r.splice(o,1),t.length>0){var s={ngModel:l,bindedFilter:t};r.push(s)}i.data("filters",r)}}},makeAutoPostSearch:function(e,t,n,a){var i=e.closest("fieldset");if(i&&i.length>0){var r=i.find("button[cronapp-filter]");if(r&&r.length>0){var o=r.data("filters");o&&o.length>0&&(t="",$(o).each(function(){t+=this.bindedFilter+";"}))}}n.search(t,"true"==a.cronappFilterCaseinsensitive)},inputBehavior:function(scope,element,attrs,ngModelCtrl,$element,typeElement,operator,autopost){var filterTemplate="",filtersSplited=attrs.cronappFilter.split(";"),datasource=eval(attrs.crnDatasource),isOData=datasource.isOData();$(filtersSplited).each(function(){this.length>0&&(""!=filterTemplate&&(filterTemplate+=isOData?" and ":";"),isOData&&("="==operator?operator="eq":"!="==operator?operator="ne":">"==operator?operator="gt":">="==operator?operator="ge":"<"==operator?operator="lt":"<="==operator&&(operator="le")),filterTemplate+="text"==typeElement?isOData?this+" "+operator+" {value}":this+"@"+operator+"%{value}%":isOData?this+" "+operator+" {value}":this+operator+"{value}")}),0==filterTemplate.length&&(filterTemplate=isOData?"{value}":"%{value}%");var selfDirective=this;ngModelCtrl?scope.$watch(attrs.ngModel,function(e,t){if(!angular.equals(e,t)){var n=$element.data("type")||$element.attr("type"),a=ngModelCtrl.$modelValue;isOData?a=a instanceof Date?"datetime-local"==n?"datetimeoffset'"+a.toISOString()+"'":"datetime'"+a.toISOString().substring(0,23)+"'":"number"==typeof a?a:"boolean"==typeof a?a:"'"+a+"'":a instanceof Date?(a=a.toISOString(),a+="date"==n?"@@date":"time"==n||"time-local"==n?"@@time":"@@datetime"):"number"==typeof a?a+="@@number":"boolean"==typeof a&&(a+="@@boolean");var i=filterTemplate.split("{value}").join(a);0==ngModelCtrl.$viewValue.length&&(i=""),selfDirective.setFilterInButton($element,i,operator),autopost&&selfDirective.makeAutoPostSearch($element,i,datasource,attrs)}}):"text"==typeElement?$element.on("keyup",function(){var datasource=eval(attrs.crnDatasource),value=void 0;value=ngModelCtrl&&void 0!=ngModelCtrl?ngModelCtrl.$viewValue:this.value;var bindedFilter=filterTemplate.split("{value}").join(value);0==this.value.length&&(bindedFilter=""),selfDirective.setFilterInButton($element,bindedFilter,operator),autopost&&selfDirective.makeAutoPostSearch($element,bindedFilter,datasource,attrs)}):$element.on("change",function(){var datasource=eval(attrs.crnDatasource),value=void 0,typeElement=$(this).attr("type");if(void 0!=attrs.asDate&&(typeElement="date"),ngModelCtrl&&void 0!=ngModelCtrl)value=ngModelCtrl.$viewValue;else if("checkbox"==typeElement)value=$(this).is(":checked");else if("date"==typeElement){if(value=this.value,this.value.length>0){var momentDate=moment(this.value,patternFormat(this));value=momentDate.toDate().toISOString()}}else value=this.value;var bindedFilter=filterTemplate.split("{value}").join(value);0==value.toString().length&&(bindedFilter=""),selfDirective.setFilterInButton($element,bindedFilter,operator),autopost&&selfDirective.makeAutoPostSearch($element,bindedFilter,datasource,attrs)})},forceDisableDatasource:function(datasourceName,scope){var disableDatasource=setInterval(function(){try{var datasourceInstance=eval(datasourceName);datasourceInstance&&($(document).ready(function(){var e=0,t=setInterval(function(){e<10?(scope.$apply(function(){datasourceInstance.enabled=!1,datasourceInstance.data=[]}),e++):clearInterval(t)},20)}),clearInterval(disableDatasource))}catch(e){}},10)},buttonBehavior:function(scope,element,attrs,ngModelCtrl,$element,typeElement,operator,autopost){var datasourceName="";datasourceName=attrs.crnDatasource?attrs.crnDatasource:$element.parent().attr("crn-datasource");var requiredFilter=attrs.requiredFilter&&"true"==attrs.requiredFilter.toString();requiredFilter&&this.forceDisableDatasource(datasourceName,scope),$element.on("click",function(){var $this=$(this),filters=$this.data("filters");if(datasourceName&&datasourceName.length>0&&filters){var bindedFilter="";$(filters).each(function(){bindedFilter+=this.bindedFilter+";"});var datasourceToFilter=eval(datasourceName);requiredFilter?(datasourceToFilter.enabled=bindedFilter.length>0,datasourceToFilter.enabled?datasourceToFilter.search(bindedFilter,"true"==attrs.cronappFilterCaseinsensitive):scope.$apply(function(){datasourceToFilter.data=[]})):datasourceToFilter.search(bindedFilter,"true"==attrs.cronappFilterCaseinsensitive)}})},link:function(e,t,n,a){var i=$(t),r=i.data("type")||i.attr("type");void 0!=n.asDate&&(r="date");var o="=";n.cronappFilterOperator&&n.cronappFilterOperator.length>0&&(o=n.cronappFilterOperator);var l=!0;n.cronappFilterAutopost&&"false"==n.cronappFilterAutopost&&(l=!1),"INPUT"==i[0].tagName?this.inputBehavior(e,t,n,a,i,r,o,l):this.buttonBehavior(e,t,n,a,i,r,o,l)}}}]).directive("cronRichEditor",["$compile",function(e){return{restrict:"E",replace:!0,require:"ngModel",parseToTinyMCEOptions:function(e){var t={};t.allowFullScreen="fullscreen |",t.allowPage="fullpage newdocument code pagebreak |",t.allowPrint="preview print |",t.allowTransferArea="cut copy paste |",t.allowDoUndo="undo redo |",t.allowSymbol="charmap |",t.allowEmbeddedImage="bdesk_photo |",t.allowFont="formatselect fontselect fontsizeselect strikethrough bold italic underline removeformat |",t.allowLinks="link unlink anchor |",t.allowParagraph="alignleft aligncenter alignright alignjustify numlist bullist outdent indent blockquote hr |",t.allowFormulas="tiny_mce_wiris_formulaEditor tiny_mce_wiris_formulaEditorChemistry tiny_mce_wiris_CAS |";var n={menubar:!1,statusbar:!1,plugins:"bdesk_photo advlist anchor autolink autoresize autosave charmap code colorpicker contextmenu directionality emoticons fullpage fullscreen hr image imagetools importcss insertdatetime legacyoutput link lists media nonbreaking noneditable pagebreak paste preview print save searchreplace tabfocus table template toc visualblocks visualchars wordcount tiny_mce_wiris",toolbar:"",content_style:""};for(var a in e)a.startsWith("allow")&&e[a]&&(n.toolbar+=" "+t[a]);return n.menubar=e.showMenuBar,n.statusbar=e.showStatusBar,n.content_style=e.contentStyle,JSON.stringify(n)},link:function(t,n,a,i){var r=JSON.parse(a.options),o=this.parseToTinyMCEOptions(r),l='                  <textarea                     ui-tinymce="$options$"                     ng-model="$ngModel$">                   </textarea>                 ';l=$(l.split("$ngModel$").join(a.ngModel).split("$options$").join(escape(o)));var s=angular.element(l);n.html(""),n.append(s),e(s)(t)}}}]).directive("cronGrid",["$compile","$translate",function($compile,$translate){return{restrict:"E",replace:!0,require:"ngModel",initCulture:function(){var e=$translate.use();e=e.replace(/_/gm,"-");var t=e.split("-");t[t.length-1]=t[t.length-1].toUpperCase(),e=t.join("-"),kendo.culture(e)},generateId:function(){var e=Math.floor(65536*(1+Math.random())).toString(16).substring(1);return"0123456789".indexOf(e.substr(0,1))>-1?this.generateId():e},generateBlocklyCall:function(e){var t;if("client"==e.type){var n=e.blocklyClass.split("/"),a=n[n.length-1];t="blockly.js.blockly."+a,t+="."+e.blocklyMethod;var i="()";e.blocklyParams.length>0&&(i="(",e.blocklyParams.forEach(function(e){i+=this.encodeHTML(e.value?e.value:"''")+","}.bind(this)),i=i.substr(0,i.length-1),i+=")"),t+=i}else if("server"==e.type){var a=e.blocklyClass+":"+e.blocklyMethod;t="cronapi.util.makeCallServerBlocklyAsync('"+a+"',null,null,",e.blocklyParams.length>0&&e.blocklyParams.forEach(function(e){t+=this.encodeHTML(e.value?e.value:"''")+","}.bind(this)),t=t.substr(0,t.length-1),t+=")"}return t},generateToolbarButtonCall:function(e,t){var n=function(e,t,n,i){return{template:function(){var r=this.generateId();return a(r,e,t,n,i)}.bind(this)}}.bind(this),a=function(e,n,a,i,r){var o="";o=r?i?'<a role="button" class="saveorcancelchanges k-button k-button-icontext k-grid-save-changes" id="#BUTTONID#" href="javascript:void(0)" ng-click="#FUNCTIONCALL#"><span class="k-icon k-i-check"></span>#TITLE#</a>':'<a role="button" class="saveorcancelchanges k-button k-button-icontext k-grid-cancel-changes" id="#BUTTONID#" href="javascript:void(0)" ng-click="#FUNCTIONCALL#"><span class="k-icon k-i-cancel" ></span>#TITLE#</a>':'<a class="k-button" id="#BUTTONID#" href="javascript:void(0)" ng-click="#FUNCTIONCALL#">#TITLE#</a>',o=o.split("#BUTTONID#").join(e).split("#FUNCTIONCALL#").join(n).split("#TITLE#").join(a);var l=setInterval(function(){if($("#"+e).length>0){var n=angular.element($("#"+e));$compile(n)(t),clearInterval(l)}},200);return o},i="";return i="SaveOrCancelChanges"==e.type?e.methodCall:this.generateBlocklyCall(e.blocklyInfo),n(i,e.title,e.saveButton,"SaveOrCancelChanges"==e.type)},getObjectId:function(e){if(e){if(e instanceof Date){var t=moment.utc(e);e=new Date(t.format("YYYY-MM-DDTHH:mm:ss"))}else if("object"==typeof e)if(e.id)e=e.id;else for(var n in e){e=e[n];break}}else e="";return e},updateFiltersFromAngular:function(e,t){var n=function(t){var n=-1,a=e.dataSource.filter()?e.dataSource.filter().filters:null;if(a)for(var i=0;i<a.length;i++)if(t.linkParentField==a[i].linkParentField){n=i;break}return n},a=function(t){var a=n(t),i=!1,r=e.dataSource.filter()?e.dataSource.filter().filters:null;a>-1?(t.value&&""!=t.value||!t.linkParentLoadIfEmpty?r[a]=t:r.splice(a,1),i=!0):(t.value&&""!=t.value||!t.linkParentLoadIfEmpty)&&(r?r.push(t):r=[t],i=!0),i&&e.dataSource.filter(r)},i=null,r=function(t,n){n.value=this.getObjectId(t),a(n),setTimeout(function(){e.trigger("change")},100)};e.dataSource.options.filterScreen.forEach(function(e){t.$watch(e.linkParentField,function(t,n){i&&(clearTimeout(i),i=null),i=setTimeout(function(){r.bind(this)(t,e)}.bind(this),500)}.bind(this))}.bind(this))},setFiltersFromLinkColumns:function(e,t,n){e.filter=[],e.filterScreen=[],t.columns.forEach(function(t){if(t.linkParentField&&t.linkParentField.length>0&&t.linkParentType&&t.linkParentType.length>0)if("screen"==t.linkParentType){var a=n[t.linkParentField];a=this.getObjectId(a);var i={field:t.field,operator:"eq",value:a,linkParentField:t.linkParentField,linkParentType:t.linkParentType,linkParentLoadIfEmpty:t.linkParentLoadIfEmpty};(a&&""!=a||!t.linkParentLoadIfEmpty)&&e.filter.push(i),e.filterScreen.push(i)}else if("hierarchy"==t.linkParentType){var i={field:t.field,operator:"eq",value:"",linkParentField:t.linkParentField,linkParentType:t.linkParentType};e.filter.push(i)}}.bind(this))},encodeHTML:function(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")},decodeHTML:function(e){return e.replace(/&apos;/g,"'").replace(/&quot;/g,'"').replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&amp;/g,"&")},getColumns:function(options,datasource,scope){function getTemplate(e){var t=void 0;return"checkbox"==e.inputType&&(t="<input type='checkbox' class='k-checkbox' #="+e.field+" ? \"checked='checked'\": '' # /><label class='k-checkbox-label k-no-text'></label>"),"switch"==e.inputType?t='<span class="k-switch km-switch k-widget km-widget k-switch-off km-switch-off" style="width: 100%">                  <span class="k-switch-wrapper km-switch-wrapper">                    <span class="k-switch-background km-switch-background" style="margin-left: #='+e.field+' ? "80%": "0%" #"></span>                  </span>                  <span class="k-switch-container km-switch-container">                    <span class="k-switch-handle km-switch-handle" style=#='+e.field+' ? "float:right;margin-right:-1px": "margin-left:0%" #>                    </span>                  </span>                </span>':e.displayField&&e.displayField.length>0?t=e.type.startsWith("date")||e.type.startsWith("month")||e.type.startsWith("time")||e.type.startsWith("week")?"#= formatDate("+e.displayField+",'"+e.format+"','"+e.type+"') #":"#="+e.displayField+"#":(e.type.startsWith("date")||e.type.startsWith("month")||e.type.startsWith("time")||e.type.startsWith("week"))&&(t="#= formatDate("+e.field+",'"+e.format+"','"+e.type+"') #"),t}function getFormat(e){if(e.format&&!e.type.startsWith("date")&&!e.type.startsWith("time")&&!e.type.startsWith("month")&&!e.type.startsWith("week"))return e.format}function getColumnByField(e){var t=null;return options.columns.forEach(function(n){n.field==e&&(t=n)}),t}function isRequired(e){var t=!1,n=null;return datasource.schema.model.fields[e]&&(n=datasource.schema.model.fields[e]),n&&(t=!n.nullable),t}function getEditor(e){return editor.bind(this)}function editor(e,t){$(e).css("position","relative");var n=getColumnByField(t.field),a=isRequired(t.field)?"required":"",i=this.generateId(),r=$("<input "+a+' name="'+t.field+'" id="'+i+'"from-grid=true />');if("dynamicComboBox"==n.inputType||"comboBox"==n.inputType){var o=app.kendoHelper.getConfigCombobox(n.comboboxOptions,scope);o.autoBind=!0,
o.optionLabel=void 0,n.displayField&&(o.change=function(e){t.model.set(n.displayField,this.text()),t.model.dirty=!0,t.model.dirtyFields[n.displayField]=!0}),r.appendTo(e).kendoDropDownList(o,scope)}else if("slider"==n.inputType){var o=app.kendoHelper.getConfigSlider(n.sliderOptions);r.appendTo(e).kendoSlider(o,scope)}else if("switch"==n.inputType){var o=app.kendoHelper.getConfigSwitch(n.switchOptions);r.appendTo(e).kendoMobileSwitch(o,scope)}else if("checkbox"==n.inputType){var l=this.generateId();r=$('<input id="'+l+'" name="'+t.field+'" class="k-checkbox" type="checkbox" ><label class="k-checkbox-label" for="'+l+'"></label>'),r.appendTo(e)}else if("date"==n.inputType){r.attr("cron-date",""),r.attr("options",JSON.stringify(n.dateOptions)),r.data("initial-date",t.model[t.field]),r.appendTo(e).off("change");var s=setInterval(function(){if($("#"+i).length>0){var e=angular.element($("#"+i));$compile(e)(scope),clearInterval(s),$("#"+i).on("change",function(){setTimeout(function(){t.model[t.field]=$("#"+i).data("rawvalue"),t.model.dirty=!0,t.model.dirtyFields[t.field]=!0}.bind(this))})}},10)}else{r.attr("type",n.type),r.attr("mask",n.format?n.format:""),r.attr("class","k-input k-textbox"),r.data("initial-value",t.model[t.field]),r.appendTo(e);var s=setInterval(function(){if($("#"+i).length>0){$("#"+i).off("change"),$("#"+i).on("change",function(){t.model[t.field]=$("#"+i).data("rawvalue"),t.model.dirty=!0,t.model.dirtyFields[t.field]=!0});var e=angular.element($("#"+i));$compile(e)(scope),clearInterval(s)}},10)}}window.formatDate=function(e,t,n){var a,i="";return e&&(a="date"==n||"datetime"==n||"time"==n?moment.utc(e):moment(e),t&&"null"!=t?i=a.format(t):(t=parseMaskType(n,$translate),i=a.format(t))),i};var columns=[];return options.columns&&options.columns.forEach(function(column){if(column.visible)if("Database"==column.dataType){var addColumn={field:column.field,title:column.headerText,type:column.type,width:column.width,sortable:column.sortable,filterable:column.filterable};addColumn.template=getTemplate(column),addColumn.format=getFormat(column),addColumn.editor=getEditor.bind(this)(column),columns.push(addColumn)}else if("Command"==column.dataType){if("no"!=options.editable){var command=column.command.split("|"),commands=[];command.forEach(function(e){var t={name:e};t.text="edit"==e?{edit:" ",update:" ",cancel:" "}:" ",commands.push(t)});var addColumn={command:commands,title:column.headerText,width:column.width?column.width:155};columns.push(addColumn)}}else if("Blockly"==column.dataType){var directiveContext=this,addColumn={command:[{name:this.generateId(),text:column.headerText,click:function(e){e.preventDefault();var tr=$(e.target).closest("tr"),grid=tr.closest("table"),item=this.dataItem(tr),index=$(grid.find("tbody")[0]).children().index(tr),consolidated={item:item,index:index},call="scope."+directiveContext.generateBlocklyCall(column.blocklyInfo);eval(call)}}],width:column.width};columns.push(addColumn)}}.bind(this)),columns},getPageAble:function(e){var t={refresh:e.allowRefreshGrid,pageSizes:e.allowSelectionTotalPageToShow,buttonCount:5};return e.allowPaging||(t=e.allowPaging),t},getToolbar:function(e,t){var n=[];return e.toolBarButtons.forEach(function(a){if("Native"==a.type)"no"!=e.editable?("save"==a.title||a.title,n.push(a.title)):"pdf"!=a.title&&"excel"!=a.title||n.push(a.title);else if("Blockly"==a.type||"SaveOrCancelChanges"==a.type){var i=this.generateToolbarButtonCall(a,t);n.push(i)}else if("Template"==a.type){var r={template:a.template};n.push(r)}}.bind(this)),0==n.length&&(n=void 0),n},getEditable:function(e){var t=e.editable;return"batch"==e.editable?t=!0:"no"==e.editable&&(t=!1),t},generateKendoGridInit:function(e,t){function n(e){if(e.masterRow.find("a").hasClass("k-i-expand"))return void r(this,e.detailRow,e.masterRow);var n=this.dataSource.transport.options.cronappDatasource;n.inserting||n.editing?i(this,null,null):(this.selectable?this.select(e.masterRow):(o.bind(this)(e.data),i(this,e.detailRow,e.masterRow)),e.sender.options.listCurrentOptions.forEach(function(n){var i=a.generateKendoGridInit(n,t),r=$("<div/>").appendTo(e.detailCell).kendoGrid(i).data("kendoGrid");r.dataSource.transport.options.grid=r}))}var a=this,i=function(e,t,n){e.table.find(".k-master-row").each(function(){null!=n&&this==n[0]||e.collapseRow(this)}),e.table.find(".k-detail-row").each(function(){null!=t&&this==t[0]||$(this).remove()})},r=function(e,t,n){e.table.find(".k-master-row").each(function(){null==n&&this!=n[0]||e.collapseRow(this)}),e.table.find(".k-detail-row").each(function(){null==t&&this!=t[0]||$(this).remove()})},o=function(e){var n=this.dataSource.transport.options.cronappDatasource;n.inserting||n.editing||t.safeApply(n.goTo(e))},l=app.kendoHelper.getDataSource(e.dataSourceScreen.entityDataSource,t,e.allowPaging,e.pageCount,e.columns),s=this.getColumns(e,l,t),c=this.getPageAble(e);return{toolbar:this.getToolbar(e,t),pdf:{allPages:!0,avoidLinks:!0,paperSize:"A4",margin:{top:"2cm",left:"1cm",right:"1cm",bottom:"1cm"},landscape:!0,repeatHeaders:!0,scale:.8},dataSource:l,editable:this.getEditable(e),height:e.height,groupable:e.allowGrouping,sortable:e.allowSorting,filterable:{mode:"row"},pageable:c,columns:s,selectable:e.allowSelectionRow,detailInit:e.details&&e.details.length>0?n:void 0,listCurrentOptions:e.details&&e.details.length>0?e.details:void 0,edit:function(e){this.dataSource.transport.options.disableAndSelect(e);var n=e.container,a=this.dataSource.transport.options.cronappDatasource;if(e.model.isNew()&&!e.model.dirty){var i=e.model;a.startInserting(null,function(e){for(var t in e)if(i.fields[t]){if(i.fields[t].validation&&i.fields[t].validation.required){var a=n.find("input[name='"+t+"']");a.length&&a.val(e[t]).trigger("change")}i.set(t,e[t])}})}else e.model.isNew()||e.model.dirty||t.safeApply(function(){var t=a.goTo(e.model);a.startEditing(t,function(e){})})},change:function(e){var t=this.dataItem(this.select());o.bind(this)(t),i(this,this.select().next(),this.select())},cancel:function(e){var n=this.dataSource.transport.options.cronappDatasource;t.safeApply(n.cancel()),this.dataSource.transport.options.enableAndSelect(e)},dataBound:function(e){this.dataSource.transport.options.selectActiveInGrid()}}},link:function(e,t,n,a){var i=$("<div></div>"),r="plugins/cronapp-framework-js/dist/js/kendo-ui/js/messages/kendo.messages.";"pt_br"==$translate.use()?r+="pt-BR.min.js":r+="en-US.min.js",this.initCulture();var o=this;$.getScript(r,function(){var t=JSON.parse(n.options||"{}");e[t.dataSourceScreen.entityDataSource.name]&&!e[t.dataSourceScreen.entityDataSource.name].dependentLazyPost&&(e[t.dataSourceScreen.entityDataSource.name].batchPost=!0,t.toolBarButtons=t.toolBarButtons||[],t.toolBarButtons.push({type:"SaveOrCancelChanges",title:$translate.instant("SaveChanges"),methodCall:t.dataSourceScreen.entityDataSource.name+".postBatchData()",saveButton:!0}),t.toolBarButtons.push({type:"SaveOrCancelChanges",title:$translate.instant("CancelChanges"),methodCall:t.dataSourceScreen.entityDataSource.name+".cancelBatchData()",saveButton:!1}));var a=o.generateKendoGridInit(t,e),r=i.kendoGrid(a).data("kendoGrid");r.dataSource.transport.options.grid=r,e.safeApply(function(){var n=setInterval(function(){e[t.dataSourceScreen.entityDataSource.name]?e[t.dataSourceScreen.entityDataSource.name].hasPendingChanges()?(i.find(".k-filter-row").hide(),i.find(".k-pager-sizes").hide(),i.find(".k-pager-nav").hide(),i.find(".k-pager-numbers").hide(),i.find(".k-pager-refresh.k-link").hide(),i.find(".saveorcancelchanges").show()):(i.find(".k-filter-row").show(),i.find(".k-pager-sizes").show(),i.find(".k-pager-nav").show(),i.find(".k-pager-numbers").show(),i.find(".k-pager-refresh.k-link").show(),i.find(".saveorcancelchanges").hide()):clearInterval(n)},100)})}),t.html(i),$compile(i)(t.scope())}}}]).directive("cronSelect",["$compile",function(e){return{restrict:"E",replace:!0,require:"ngModel",link:function(e,t,n,a){var i={};try{i=JSON.parse(n.options)}catch(e){console.log("ComboBox invalid configuration! "+e)}var r=n.id?' id="'+n.id+'"':"",o=n.name?' name="'+n.name+'"':"",l=t.parent();$(l).append('<input style="width: 100%;" '+r+o+' class="cronSelect" ng-model="'+n.ngModel+'"/>');var s=$(l).find("input.cronSelect"),c=app.kendoHelper.getConfigCombobox(i,e),d=s.kendoComboBox(c).data("kendoComboBox");$(t).remove();var u=e,p=a;s.on("change",function(e){u.$apply(function(){p.$setViewValue(this.value())}.bind(d))}),a&&(a.$formatters.push(function(e){var t="";return e&&(t=e),d.value(t),t}),a.$parsers.push(function(e){return e||null}))}}}]).directive("cronDynamicSelect",["$compile",function(e){return{restrict:"E",replace:!0,require:"ngModel",link:function(e,t,n,a){var i={};try{i=JSON.parse(n.options)}catch(e){console.log("DynamicComboBox invalid configuration! "+e)}var r=app.kendoHelper.getConfigCombobox(i,e);try{delete r.dataSource.schema.model.id}catch(e){}var o=t.parent(),l=n.id?' id="'+n.id+'"':"",s=n.name?' name="'+n.name+'"':"";$(o).append('<input style="width: 100%;"'+l+s+' class="cronDynamicSelect" ng-model="'+n.ngModel+'"/>');var c=$(o).find("input.cronDynamicSelect");$(t).remove(),r.dataBound=function(e){var t=$(d).data("currentValue");null!=t&&setTimeout(function(){d.value(t)},300),$(d).data("currentValue",null)};var d=c.kendoDropDownList(r).data("kendoDropDownList");d.dataSource.transport&&d.dataSource.transport.options&&(d.dataSource.transport.options.grid=d);var u=e,p=a;c.on("change",function(e){u.$apply(function(){p.$setViewValue(this.dataItem())}.bind(d))}),a&&(a.$formatters.push(function(e){var t="";return e&&("string"==typeof e?t=e:e[i.dataValueField]&&(t=e[i.dataValueField])),$(d).data("currentValue",t),view=d.dataSource.view(),!view||Array.isArray(view)&&0==view.length?d.dataSource.read():d.value(t),t}),a.$parsers.push(function(e){if(e)if(!0===d.options.valuePrimitive){if("string"==typeof e)return e;if(e[i.dataValueField])return e[i.dataValueField]}else try{return objectClone(e,this.dataSource.options.schema.model.fields)}catch(e){}return null}.bind(d)))}}}]).directive("cronMultiSelect",["$compile",function($compile){return{restrict:"E",require:"ngModel",link:function(scope,element,attrs,ngModelCtrl){var _self=this,select={};try{select=JSON.parse(attrs.options)}catch(e){console.log("MultiSelect invalid configuration! "+e)}var _scope=scope,_ngModelCtrl=ngModelCtrl;relactionDS={relationDataSource:null!=select.relationDataSource?eval(select.relationDataSource.name):null,relationField:null!=select.relationField?select.relationField:""};var options=app.kendoHelper.getConfigCombobox(select,scope);try{delete options.dataSource.schema.model.id}catch(e){}var parent=element.parent(),id=attrs.id?' id="'+attrs.id+'"':"",name=attrs.name?' name="'+attrs.name+'"':"";$(parent).append('<input style="width: 100%;"'+id+name+' class="cronMultiSelect" ng-model="'+attrs.ngModel+'"/>');var $element=$(parent).find("input.cronMultiSelect");$(element).remove(),options.deselect=function(e){var t=e.dataItem,n=this.relationDataSource,a=e.sender.options.dataValueField,i=null;if(n&&n.data&&t[a]){for(key in n.data){var r=n.data[key];if(r[this.relationField]&&r[this.relationField]==t[a]){i=r;break}}null!=i&&($(combobox).data("silent",!0),this.relationDataSource.removeSilent(i,null,null))}}.bind(relactionDS),options.select=function(e){var t=e.dataItem,n=e.sender.options.dataValueField;if(this.relationDataSource&&t[n]){var a={};a[this.relationField]=t[n];var i=e.sender;$(i).data("silent",!0),this.relationDataSource.startInserting(a,function(e){this.postSilent()}.bind(this.relationDataSource))}}.bind(relactionDS);var combobox=$element.kendoMultiSelect(options).data("kendoMultiSelect");combobox.dataSource.transport&&combobox.dataSource.transport.options&&(combobox.dataSource.transport.options.grid=combobox);var convertArray=function(e){var t=[];if(e)for(var n in e)t.push(e[n][relactionDS.relationField]);return t};scope.$watchCollection(function(){return ngModelCtrl.$modelValue},function(e,t){var n=$(combobox).data("silent");$(combobox).data("silent",!1),n||JSON.stringify(e)===JSON.stringify(t)||combobox.value(convertArray(e))})}}}]).directive("cronAutoComplete",["$compile",function(e){return{restrict:"E",require:"ngModel",link:function(e,t,n,a){var i={};try{i=JSON.parse(n.options)}catch(e){console.log("AutoComplete invalid configuration! "+e)}try{delete r.dataSource.schema.model.id}catch(e){}var r=app.kendoHelper.getConfigCombobox(i,e),o=t.parent(),l=n.id?' id="'+n.id+'"':"",s=n.name?' name="'+n.name+'"':"";$(o).append('<input style="width: 100%;" '+l+s+' class="cronAutoComplete" ng-model="'+n.ngModel+'"/>');var c=$(o).find("input.cronAutoComplete");r.change=function(t){e.$apply(function(){a.$setViewValue(c.val())})};var d=c.kendoAutoComplete(r).data("kendoAutoComplete");d.dataSource.transport&&d.dataSource.transport.options&&(d.dataSource.transport.options.grid=d),$(t).remove(),a&&(a.$formatters.push(function(e){var t="";return e&&("string"==typeof e?t=e:e[i.dataTextField]&&(t=e[i.dataTextField])),d.value(t),t}),a.$parsers.push(function(e){if(e){if("string"==typeof e)return e;if(e[i.dataTextField])return e[i.dataTextField]}return null}))}}}]).directive("cronDate",["$compile","$translate","$window",function(e,t,n){return{restrict:"AE",require:"?ngModel",link:function(e,n,a,i){var r={},o={};try{if(a.options)o=JSON.parse(a.options);else{var l=window.buildElementOptions(n);o=JSON.parse(l)}o.format||(o.format=parseMaskType(o.type,t)),r=app.kendoHelper.getConfigDate(t,o)}catch(e){console.log("AutoComplete invalid configuration! "+e)}var s,c="date"==r.type||"datetime"==r.type||"time"==r.type;if(a.fromGrid)s=$(n);else{var d=n.parent(),u=$('<input style="width: 100%;" class="cronDate" ng-model="'+a.ngModel+'"/>');$(d).append(u),s=$(d).find("input.cronDate"),s.data("type",r.type),s.attr("type","date")}var p=app.kendoHelper.buildKendoMomentPicker(s,r,e,i);if(a.fromGrid){var m=function(){var e=null,t=$(this).val();$(this).data("initial-date")&&(t=$(this).data("initial-date"),$(this).data("initial-date",null)),e=c?moment.utc(t,r.momentFormat):moment(t,r.momentFormat),p.value(e.format(r.momentFormat)),$(this).data("rawvalue",e.toDate())};$(n).on("keydown",m).on("keyup",m).on("change",m),m.bind(s)()}else i&&(i.$formatters.push(function(e){var t=null;if(e){var n=null;n=c?moment.utc(e):moment(e),t=n.format(r.momentFormat)}return p.value(t),t}),i.$parsers.push(function(e){if(e){var t=null;return t=c?moment.utc(p._oldText,r.momentFormat):moment(p._oldText,r.momentFormat),t.toDate()}return null})),$(n).remove()}}}]).directive("cronSlider",["$compile",function(e){return{restrict:"E",require:"ngModel",link:function(e,t,n,a){var i={};try{i=JSON.parse(n.options)}catch(e){console.log("Slider invalid configuration! "+e)}var r=function(n){e.$apply(function(){a.$setViewValue(parseInt($(t).val()))})},o=function(e){r()},l=function(e){r()},s=app.kendoHelper.getConfigSlider(i);s.change=o,s.slide=l,$(t).empty();var i=$(t).kendoSlider(s).data("kendoSlider");e.$watch(function(){return a.$modelValue},function(e,t){e!==t&&(e?i.value(e):i.value(i.min()))}),a&&(a.$formatters.push(function(e){var t=null;return!e&&i.min?t=i.min:e&&(t=e),i.value(t),t}),a.$parsers.push(function(e){return e||null}))}}}]).directive("cronSwitch",["$compile",function(e){return{restrict:"E",require:"ngModel",link:function(e,t,n,a){var i={};try{var r=window.buildElementOptions(t);i=JSON.parse(r)}catch(e){console.log("Switch invalid configuration! "+e)}var o=app.kendoHelper.getConfigSwitch(i),l=t.parent();$(l).append('<input style="width: 100%;" class="cronSwitch" ng-model="'+n.ngModel+'"/>');var s=$(l).find("input.cronSwitch"),c=function(t){e.$apply(function(){a.$setViewValue(this.value())}.bind(this))};o.change=c;var d=s.kendoMobileSwitch(o).data("kendoMobileSwitch");$(t).remove(),a&&(a.$formatters.push(function(e){var t=!1;return void 0!=e&&(t=e),d.value(t),t}),a.$parsers.push(function(e){return void 0!=e&&e}))}}}]).directive("cronBarcode",["$compile",function(e){return{restrict:"E",require:"ngModel",link:function(e,t,n,a){var i={};try{var r=window.buildElementOptions(t);i=JSON.parse(r)}catch(e){console.log("Barcode invalid configuration! "+e)}var o=app.kendoHelper.getConfigBarcode(i),l=t.parent();$(l).append('<span class="cronBarcode" ng-model="'+n.ngModel+'"></span>');var s=$(l).find("span.cronBarcode"),c=s.kendoBarcode(o).data("kendoBarcode");$(t).remove(),e.$watch(function(){return a.$modelValue},function(e,t){var n="";e!==t&&(n=e),o.value=n,c.setOptions(o)})}}}]).directive("cronQrcode",["$compile",function(e){return{restrict:"E",require:"ngModel",link:function(e,t,n,a){var i={};try{var r=window.buildElementOptions(t);i=JSON.parse(r)}catch(e){console.log("Qrcode invalid configuration! "+e)}var o=app.kendoHelper.getConfigQrcode(i),l=t.parent();$(l).append('<span class="cronQrcode" ng-model="'+n.ngModel+'"></span>');var s=$(l).find("span.cronQrcode"),c=s.kendoQRCode().data("kendoQRCode");$(t).remove(),e.$watch(function(){return a.$modelValue},function(e,t){var n="";e!==t&&(n=e),o.value=n,c.setOptions(o)})}}}])}(app);